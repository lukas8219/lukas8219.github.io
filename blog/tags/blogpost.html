<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">2 posts tagged with &quot;blogpost&quot; | Lucas Weis Polesello | SRE &amp; Sr Software Engineer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lukas8219.github.io/img/obsidiosaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lukas8219.github.io/img/obsidiosaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lukas8219.github.io/blog/tags/blogpost"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="2 posts tagged with &quot;blogpost&quot; | Lucas Weis Polesello | SRE &amp; Sr Software Engineer"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="https://github.com/lukas8219.png"><link data-rh="true" rel="canonical" href="https://lukas8219.github.io/blog/tags/blogpost"><link data-rh="true" rel="alternate" href="https://lukas8219.github.io/blog/tags/blogpost" hreflang="en"><link data-rh="true" rel="alternate" href="https://lukas8219.github.io/blog/tags/blogpost" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RE0I3LUV18-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Lucas Weis Polesello | SRE &amp; Sr Software Engineer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Lucas Weis Polesello | SRE &amp; Sr Software Engineer Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Lucas Weis Polesello | SRE &amp; Sr Software Engineer" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.5eac164b.css">
<link rel="preload" href="/assets/js/runtime~main.4932596a.js" as="script">
<link rel="preload" href="/assets/js/main.846843c0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://github.com/lukas8219.png" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://github.com/lukas8219.png" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">LWP Softwares</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/learn-in-public/Engineering/AMQP/AMQP Protocol - Model and Protocol">Learn in Public</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/tags/blogpost" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/lukas8219/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/04/06/data-strucutres-applicability">DataStructure Applicabilities - Bitmap and Access Control: How to scale notifications with ACL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/03/31/network-bandwidth-reduction">The Tale of How We Compensated Years of Tech Debt in a Month: Performance, Cost and Optimizations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/03/31/open-source-tales-1">Open Source Tales #1: WebSocket Operator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/15/redis-is-more-than-cache-data-reference">Redis is more than a Cache - Data Reference</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/15/redis-is-more-than-cache-job-delay">Redis is more than a Cache - Delaying Jobs</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;blogpost&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2025/03/31/network-bandwidth-reduction">The Tale of How We Compensated Years of Tech Debt in a Month: Performance, Cost and Optimizations</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-31T00:00:00.000Z" itemprop="datePublished">March 31, 2025</time> Â· <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/lukas8219" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/lukas8219.png" alt="Lucas Weis Polesello"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lukas8219" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lucas Weis Polesello</span></a></div><small class="avatar__subtitle" itemprop="description">SRE | Senior Software Engineer @ LumaHealth</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Back in 2022 <a href="https://www.lumahealth.io/" target="_blank" rel="noopener noreferrer">@Luma</a> had a major outage which caused hours of downtime, angry customers and lots of engineering efforts to return the product back to normal.
One of the discoveries made at that time was a hard truth: <code>we modeled our internal IAM object poorly</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inb4-phi">inb4: PHI<a href="#inb4-phi" class="hash-link" aria-label="Direct link to inb4: PHI" title="Direct link to inb4: PHI">â</a></h2><p>On the HealthCare Tech Industry - and outside of it - Patient Health Information (PHI) is of major importance. When applied to Luma&#x27;s platform - being <em>very</em> brief - states that patient&#x27;s data should belong only to facilities that they had interaction with/allowed them to have.
This is to protect patient&#x27;s health information and access to their data. It&#x27;s a US-government enforced law.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iam-model">IAM Model<a href="#iam-model" class="hash-link" aria-label="Direct link to IAM Model" title="Direct link to IAM Model">â</a></h2><p>Our IAM model is something called <code>session</code> object - a pretty simple concept - it concentrates the user&#x27;s token, settings, groups, facilities and more metadata about itself. We use this <code>session</code> throughout all backend components of Luma to properly apply this PHI filtering rule.
One of the bad decision back then was to simply pull all <code>facilities</code> and <code>groups</code> inside a JSON object and cache it. But then you would probably ask...</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-the-problem-of-it">What&#x27;s the problem of it?<a href="#whats-the-problem-of-it" class="hash-link" aria-label="Direct link to What&#x27;s the problem of it?" title="Direct link to What&#x27;s the problem of it?">â</a></h3><p>When Luma grown it&#x27;s scale - we started onboarding bigger and bigger customers - with their own setup of account leading to N different use-cases.
Summing up some very creative account setups and huge customers - we ended up creating something unexpected - <code>session</code> object storing up to 2.6MB of pure JSON text.</p><p>And yes, you did read it right - an entire PDF!!</p><p>Now <code>imagine that for each job, we actually pulled cached sessions up to 100x - or even more. Luma produces average of 2K jobs per second spiking up to 10K</code></p><p><strong>That&#x27;s <code>ALOT</code> of Network usage.</strong> - easily surpassing 2GB per second - aka more than 15Gbps.
For reference - <a href="https://instances.vantage.sh/aws/elasticache/cache.m6g.8xlarge" target="_blank" rel="noopener noreferrer">cache.m6g.8xlarge</a> which is a fair-sized cache instance has this bandwidth.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure-impact">Infrastructure Impact<a href="#infrastructure-impact" class="hash-link" aria-label="Direct link to Infrastructure Impact" title="Direct link to Infrastructure Impact">â</a></h3><p>All of a sudden Luma has this scenario:</p><ul><li>Slow and unstable HTTP APIs</li><li>Had to oversize more than usual to handle same load - a very low overall ~400RPS</li><li>Had to split our Broker instance into smaller and focused one&#x27;s</li><li>Had to increase our cache size</li><li>We had to create one thing called <code>pubsub-service</code> (yes and yes, no bueno) to offload services of slow publishes.</li><li>With this - we also created a <code>jobless</code> feature which forced backend components to publish only the <code>jobId</code> and route the job content itself via Redis.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-business-impact-money-being-thrown-away-and-unsatisfied-customers">The Business Impact? Money being thrown away and unsatisfied customers<a href="#the-business-impact-money-being-thrown-away-and-unsatisfied-customers" class="hash-link" aria-label="Direct link to The Business Impact? Money being thrown away and unsatisfied customers" title="Direct link to The Business Impact? Money being thrown away and unsatisfied customers">â</a></h2><p>Given it&#x27;s mission-critical importance of <code>Session</code> - the risks were just too high until 1st of March 2025.
After good months of investigation, searching code, trying to run AST analysis (codemod) in almost the entire codebase and libraries - it sounded like we had a solution in-mind.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-simple-feature-flag---that-would-do-queryselect_id-when-querying-groups---building-the-session-with-less-data">A simple feature flag - that would do <code>Query.select(_id)</code> when querying <code>Groups</code> - building the session with less data.<a href="#a-simple-feature-flag---that-would-do-queryselect_id-when-querying-groups---building-the-session-with-less-data" class="hash-link" aria-label="Direct link to a-simple-feature-flag---that-would-do-queryselect_id-when-querying-groups---building-the-session-with-less-data" title="Direct link to a-simple-feature-flag---that-would-do-queryselect_id-when-querying-groups---building-the-session-with-less-data">â</a></h4><p>Although simple and sustained by a lot of research we were still cautious by setting up lots of product metrics and log metrics to understand wether rolled customers would have negative impact - like messaging not going out, notifications being missed or even worse - entire product breakdown.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rollout-and-implementation">Rollout and Implementation<a href="#rollout-and-implementation" class="hash-link" aria-label="Direct link to Rollout and Implementation" title="Direct link to Rollout and Implementation">â</a></h3><ul><li>We needed to ensure our libraries were at least a certain version</li><li>Enable flag for each customer tenant <em>id</em></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="outcome">Outcome<a href="#outcome" class="hash-link" aria-label="Direct link to Outcome" title="Direct link to Outcome">â</a></h3><p>It took us nearly a month rolling out <strong>90 backend services</strong> and a week enabling the flag for all customers. But the results are very expressive.</p><ul><li>60% Network usage reduction. It&#x27;s been weeks we don&#x27;t have any alerts about Network Bandwidth</li><li>Stable API latencies. We are now able to downsize our infrastructure back to normal levels - we are estimating to downsize REST layer resources by 1/4</li><li>Almost zero&#x27;ed PubSub bandaid network usage. We are now <code>unblocked</code> to remove the <code>bandaid</code> solutions like <code>pubsub-service</code> and <code>sessionless</code> code</li></ul><p>REST Layer p75 to p95 stability and latencies drop after 03/11 - first customers.</p><p><img loading="lazy" alt="rest-latencies" src="/assets/images/rest-latencies-20e1d8d0841730a0294e725627cccbe4.webp" width="1118" height="396" class="img_ev3q"></p><p>Comparing pre-rollout weeks(03/17) to post-rollout (03/17) - Check the end of the graph
<img loading="lazy" alt="monthly-bandwidth-usage" src="/assets/images/monthly-bandwidth-usage-bc6bae758b21a72998e859a3a3727c6e.webp" width="1600" height="797" class="img_ev3q"></p><p>Post-Rollout Monday (Busiest day of week)
<img loading="lazy" alt="busy-monday-after-rollout" src="/assets/images/busy-monday-after-rollout-6b96c54b0c9aeceb789153eabebc0054.webp" width="1600" height="545" class="img_ev3q">
Pre-Rollout Monday (Busiest day of week)
<img loading="lazy" alt="busy-monday-pre" src="/assets/images/busy-monday-pre-39cdb70edf2590a14126621919035305.webp" width="1600" height="523" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="takeaway-points">TakeAway Points<a href="#takeaway-points" class="hash-link" aria-label="Direct link to TakeAway Points" title="Direct link to TakeAway Points">â</a></h2><p>There&#x27;s much more coming in the future - but we are <strong>happy</strong> to finally unblock the road for bigger impact optimizations.</p><p>To build good product, find market-fit, prioritize customers and market requirements is an <code>art of business</code> but I deeply think that there&#x27;s some bounding between business and this <code>not-so-celebrated-kind-of-stuff</code>.</p><p>At the end of the day - delivering a reliable, stable and ever-growing platform requires revisiting past decisions - behind a healthy and stable platform is a great patient experience and efficient staff.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/redis">redis</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/bandwidth">bandwidth</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cost">cost</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/efficient">efficient</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/luma">luma</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blogpost">blogpost</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2025/03/31/open-source-tales-1">Open Source Tales #1: WebSocket Operator</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-31T00:00:00.000Z" itemprop="datePublished">March 31, 2025</time> Â· <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/lukas8219" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/lukas8219.png" alt="Lucas Weis Polesello"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lukas8219" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lucas Weis Polesello</span></a></div><small class="avatar__subtitle" itemprop="description">SRE | Senior Software Engineer @ LumaHealth</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>One of the most interesting career challenges I&#x27;ve faced was something trivial in the world of <strong>stateless</strong> services but challenging in <strong>stateful</strong> - enabling WebSocket instances to scale horizontally.</p><p>This <strong>challenge</strong> comes in many flavors and ours had some constraints:</p><ul><li>It had to respect our internal framework - listening por model events</li><li>We had to apply IAM filtering</li><li>Had to use SocketIO</li><li>SocketIO plugins like RabbitMQ were not valid. Team judge as costly.</li><li>Redis Plugins were not fit.</li><li>We had to support multi-tab</li><li>No infrastructure involved</li></ul><p>Basically our WebSocket servers ran with old versions of SocketIO and had they very poor usage of its benefits, to say the least. It could&#x27;ve been a simple WebSocket server.</p><p>To scale it horizontally, we decided to use Redis PubSub - by simply allowing clients-server communicate via Redis PubSub.</p><p><img loading="lazy" alt="thumbnail-ws-operator-blogpost" src="/assets/images/thumbnail-ws-operator-blogpost-9370f75714fb48ffa5307fbbc51183cd.webp" width="1024" height="1024" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-of-project-and-i-learned-something-very-important">End of Project and I learned something very important<a href="#end-of-project-and-i-learned-something-very-important" class="hash-link" aria-label="Direct link to End of Project and I learned something very important" title="Direct link to End of Project and I learned something very important">â</a></h3><p>And that is <code>choosing to scale WebSocket</code> was a bad idea by itself. As intrinsic to distributed systems, problems like:</p><ul><li>Observability</li><li>Redis PubSub deliverability issues and Network bandwidth</li><li>It lacked re-balancing connections - hot replicas vs cold replicas by amount of conns.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="but-i-had-so-many-limitations-that-i-crossed-my-mind">But I had so many limitations that I crossed my mind:<a href="#but-i-had-so-many-limitations-that-i-crossed-my-mind" class="hash-link" aria-label="Direct link to But I had so many limitations that I crossed my mind:" title="Direct link to But I had so many limitations that I crossed my mind:">â</a></h3><p>What If I could just use the underlying environment - aka Kubernetes - for this kind of stuff? Some refined load balancing? Proper routing of messages via proxy? <strong>(TBH a simple RMQ would&#x27;ve done the job so far)</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="considering-that-i-never-ever-stopped-dreaming-about-a-better-design-for-this-problem">Considering that I never-ever stopped dreaming about a better design for this problem<a href="#considering-that-i-never-ever-stopped-dreaming-about-a-better-design-for-this-problem" class="hash-link" aria-label="Direct link to Considering that I never-ever stopped dreaming about a better design for this problem" title="Direct link to Considering that I never-ever stopped dreaming about a better design for this problem">â</a></h3><p>By consequence 2y ears later I stumbled upon <a href="https://medium.com/lumen-engineering-blog/how-to-implement-a-distributed-and-auto-scalable-websocket-server-architecture-on-kubernetes-4cc32e1dfa45" target="_blank" rel="noopener noreferrer">this article</a> which described - beautifully - how they solved scalability for a WebSocket stateful app.</p><p>It motivated me into a <em>crazy journey</em>: <code>If I solved the same issue, if they solved the same issue and we had similar ideas. How many people are solving this same challenge?</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="introducing-you-websocket-operator">Introducing you <a href="https://github.com/lukas8219/websocket-operator" target="_blank" rel="noopener noreferrer">websocket-operator</a><a href="#introducing-you-websocket-operator" class="hash-link" aria-label="Direct link to introducing-you-websocket-operator" title="Direct link to introducing-you-websocket-operator">â</a></h3><p><img loading="lazy" alt="ws-operator-poc-diagram" src="/assets/images/ws-operator-poc-diagram-d2ea4bae3f4e4efc48ba53ae4744a822.webp" width="1536" height="1024" class="img_ev3q"></p><p>In this blueprint and <code>not-yet-prod-deployed-oss-project</code> I&#x27;ve mixed two main ingredients:</p><ul><li>The need to learn heavier GO and Kubernetes Operator.</li><li>A problem I&#x27;ve already solved - but now with no limitations</li></ul><p>The Operator consists of three main components - and yes they are very similar to those from the article.</p><ul><li>A LoadBalancer<ul><li>A end-user exposed API that accepts connections and routes to proper proxy-sidecars.</li><li>It applies a distributed load balancing algorithm - shared with the <code>Proxy SideCar</code></li><li>It uses a Kubernetes Service Discovery to check for available IP&#x27;s to load-balancer.</li></ul></li><li>Proxy SideCar<ul><li>Intercept WS Messages and proxies via HTTP to another <code>Proxy SideCar</code> that may have the connection for such recipient.</li><li>It shares the same algorithm from LoadBalancer - they can find themselves</li></ul></li><li>Controller<ul><li>Injects the SideCar in Deployments/Pods with <code>ws.operator/enabled</code> label</li><li>Re-Balances connected users.</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="roadmap">Roadmap<a href="#roadmap" class="hash-link" aria-label="Direct link to Roadmap" title="Direct link to Roadmap">â</a></h3><p>This is pretty much inspired in the articles <code>Signaling Servers</code> design and has some interesting features in the Roadmap:</p><ul><li>Pluggable Hashing Algorithm for Routing<ul><li>Plug your own algorithm to load balance connections</li></ul></li><li>Pluggable Routing<ul><li>v0.0.1 will assume WS is exchanging JSON messages - but they could be RAW binaries, or just simple text with their own protocol.</li></ul></li><li>Support Broadcasting</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="takeaway">TakeAway<a href="#takeaway" class="hash-link" aria-label="Direct link to TakeAway" title="Direct link to TakeAway">â</a></h3><ul><li>There&#x27;s a intelectual value in reinventing the wheel</li><li>Do not scale <strong>stateful apps</strong> unless very needed</li><li>And if you need, reconsider it again. You might be safer just oversizing infrastructure</li><li>Ok, you really need it. Study, investigate, research and well, feel free to benchmark this plug and play solution.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/websocket">websocket</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blogpost">blogpost</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 LWP Softwares. MIT</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4932596a.js"></script>
<script src="/assets/js/main.846843c0.js"></script>
</body>
</html>